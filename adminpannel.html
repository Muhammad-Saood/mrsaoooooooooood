<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Web3 Airdrop</title>
<link rel="icon" href="https://raw.githubusercontent.com/Muhammad-Saood/ROSE/main/favicon1.ico" />
<style>
body {margin:0; padding:0; font-family: Arial, sans-serif; background:#0d0d0d; color:white; text-align:center;}
.container {max-width:800px; margin:auto; padding:20px;}
input, textarea, button {width:95%; margin:5px 0; padding:10px; border-radius:8px; border:none; font-size:16px;}
button {cursor:pointer; background:#ff0077; color:white;}
button:hover {background:#e6006a;}
.cardItem {display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,0.1); padding:10px; margin:8px 0; border-radius:10px; cursor:grab;}
.cardItem img {width:50px; height:50px; border-radius:8px; margin-right:10px;}
.cardInfo {flex-grow:1; text-align:left;}
.deleteBtn {background:red; border:none; color:white; padding:6px 10px; border-radius:6px; cursor:pointer;}
</style>
</head>
<body>
<div class="container" id="loginBox">
<h2>Admin Login</h2>
<input type="password" id="password" placeholder="Enter Secret Key" />
<button onclick="checkPass()">Login</button>
</div>

<div class="container" id="adminPanel" style="display:none;">
<h2>Admin Panel</h2>
<p>⚠️ Make sure your GitHub PAT is valid. Keep it secret!</p>
<input type="text" id="ghToken" placeholder="GitHub Personal Access Token" />
<input type="text" id="ghUser" placeholder="GitHub Username" />
<input type="text" id="ghRepo" placeholder="Repository Name" />
<input type="text" id="ghPath" placeholder="cards.json path (default: cards.json)" value="cards.json" />
<hr>
<input id="logo" placeholder="Logo URL" />
<input id="name" placeholder="Airdrop Name" />
<textarea id="detail" placeholder="Description"></textarea>
<input id="link" placeholder="Airdrop Link" />
<button onclick="addCard()">Add Card</button>
<button onclick="saveCardsToGitHub()">Save All Changes</button>
<div id="cardListAdmin"></div>
</div>

<script>
const secret = "Saud20759@";
let cards = [];
let dragSrcIndex = null;

function checkPass(){
    const val = document.getElementById("password").value;
    if(val===secret){
        document.getElementById("loginBox").style.display="none";
        document.getElementById("adminPanel").style.display="block";
        loadCardsFromGitHub();
    } else {
        alert("Incorrect password!");
    }
}

// Load cards.json from GitHub
async function loadCardsFromGitHub(){
    const user = prompt("Enter GitHub username:");
    const repo = prompt("Enter GitHub repo name:");
    const path = "cards.json";
    try {
        const res = await fetch(`https://raw.githubusercontent.com/${user}/${repo}/main/${path}`);
        if(!res.ok) throw new Error("Cannot fetch cards.json");
        cards = await res.json();
        renderAdminCards();
    } catch(err){
        console.error(err);
        alert("Failed to load cards.json");
    }
}

function renderAdminCards(){
    const list = document.getElementById('cardListAdmin');
    list.innerHTML='';
    cards.forEach((c,i)=>{
        const div=document.createElement('div');
        div.className='cardItem';
        div.draggable=true;
        div.ondragstart=e=>dragStart(e,i);
        div.innerHTML=`<img src="${c.logo}" /><div class="cardInfo"><b>${c.name}</b><br>${c.detail}</div><button class="deleteBtn" onclick='deleteCard(${i})'>Delete</button>`;
        list.appendChild(div);
    });
}

function addCard(){
    const logo=document.getElementById("logo").value;
    const name=document.getElementById("name").value;
    const detail=document.getElementById("detail").value;
    const link=document.getElementById("link").value;
    if(!logo || !name || !link){ alert("Logo, Name, and Link are required!"); return;}
    cards.push({logo,name,detail,link});
    renderAdminCards();
    document.getElementById("logo").value=""; document.getElementById("name").value=""; document.getElementById("detail").value=""; document.getElementById("link").value="";
}

function deleteCard(i){ cards.splice(i,1); renderAdminCards(); }

function dragStart(e,index){ dragSrcIndex=index; }
document.getElementById('cardListAdmin').addEventListener('dragover',e=>e.preventDefault());
document.getElementById('cardListAdmin').addEventListener('drop',e=>{
    e.preventDefault();
    let targetDiv=e.target.closest('.cardItem');
    if(!targetDiv) return;
    let targetIndex=Array.from(document.getElementById('cardListAdmin').children).indexOf(targetDiv);
    if(targetIndex===dragSrcIndex) return;
    let temp=cards[dragSrcIndex]; cards[dragSrcIndex]=cards[targetIndex]; cards[targetIndex]=temp;
    renderAdminCards();
});

// Save cards.json to GitHub via API
async function saveCardsToGitHub(){
    const token=prompt("Enter GitHub PAT (keep secret)","");
    const user=prompt("GitHub Username","");
    const repo=prompt("GitHub Repo Name","");
    const path="cards.json";
    const message="Update cards.json via admin panel";
    try{
        // Get SHA of current file
        const resGet=await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${path}`);
        if(!resGet.ok) throw new Error("Cannot get file SHA");
        const data=await resGet.json();
        const sha=data.sha;
        const content= btoa(unescape(encodeURIComponent(JSON.stringify(cards, null, 2))));
        const resPut=await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${path}`,{
            method:"PUT",
            headers:{Authorization:`token ${token}`, "Content-Type":"application/json"},
            body: JSON.stringify({message, content, sha})
        });
        if(!resPut.ok) throw new Error("Failed to save");
        alert("cards.json updated successfully!");
    } catch(err){ console.error(err); alert(err); }
}
</script>
</body>
</html>
